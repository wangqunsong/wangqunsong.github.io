<html>

<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>
    pipelineå‚è€ƒæ‰‹å†Œã€Œè½¬] | zootopiaçš„åèŠ±å›­
</title>
<link rel="shortcut icon" href="http://wangqunsong.github.io/favicon.ico?v=1569401796045">
<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="http://wangqunsong.github.io/styles/main.css">
<!-- js -->
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="http://wangqunsong.github.io/media/js/jquery.sticky-sidebar.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


        
</head>

<body>
    <div class="main">
        <div class="header">
    <div class="nav">
        <div class="logo">
            <a href="http://wangqunsong.github.io">
                <img class="avatar" src="http://wangqunsong.github.io/images/avatar.png?v=1569401796045" alt="">
            </a>
            <div class="site-title">
                <h1>
                    zootopiaçš„åèŠ±å›­
                </h1>
            </div>
        </div>
        <span class="menu-btn fa fa-align-justify"></span>
        <div class="menu-container">
            <ul>
                
                    
                            <li>
                                <a href="http://wangqunsong.github.io" class="menu">
                                    é¦–é¡µ
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="http://wangqunsong.github.io/archives" class="menu">
                                    å½’æ¡£
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="http://wangqunsong.github.io/tags" class="menu">
                                    æ ‡ç­¾
                                </a>
                            </li>
                            
                                
            </ul>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $(".menu-btn").click(function() {
            $(".menu-container").slideToggle();
        });
        $(window).resize(function() {

            if (window.matchMedia('(min-width: 960px)').matches) {
                $(".menu-container").css('display', 'block')
            } else {
                $(".menu-container").css('display', 'none')
            }

        });
    });
</script>

            <div id="main-content" class="post-detail main-container">
                <!-- left -->
                <div id="content" class="main-container-left">
                    <article class="post i-card">
                        <h2 class="post-title">
                            pipelineå‚è€ƒæ‰‹å†Œã€Œè½¬]
                        </h2>
                        <div class="post-info">
                            <time class="post-time">2018-06-07</time>
                            
                                <a href="http://wangqunsong.github.io/tag/AZvxNNEdR" class="post-tag i-tag
                            i-tag-info">
                            #CI/CD
                        </a>
                                
                        </div>
                        
                                <div class="post-content">
                                    <p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ æ¥åˆ°å°å°ç‹çš„åèŠ±å›­ï¼<br>
âœï¸  è¿™é‡Œä»…ä»…æ˜¯ä¸€ä¸ªè®°å½•ä¸ªäººæˆé•¿çš„åœ°æ–¹ï¼Œç°åœ¨æ‰€å¤„çš„ä½ç½®æ˜¯<strong>pipelineå‚è€ƒæ‰‹å†Œã€Œè½¬]</strong></p>
<!-- more --> 
<h2 id="ä¸€-å†™åœ¨å‰é¢">ä¸€ã€å†™åœ¨å‰é¢</h2>
<p>æœ¬pipelineä¸­æ–‡ç‰ˆå‚è€ƒæ‰‹å†Œè¯‘è€…ä¸º<a href="https://testerhome.com/cay">TesterHome@cay</a>ï¼Œæ‰€æœ‰æƒå½’åŸè¯‘è€…æ‰€æœ‰ã€‚</p>
<p>è‹±è¯­å¥½çš„å»ºè®®ç›´æ¥ç§»æ­¥å®˜ç½‘é˜…è¯»ï¼š<a href="https://jenkins.io/doc/book/pipeline/">Jenkins pipeline</a></p>
<h2 id="äºŒ-è¯­æ³•ç®€ä»‹">äºŒã€è¯­æ³•ç®€ä»‹</h2>
<p>Pipelineæœ€åŸºæœ¬çš„éƒ¨åˆ†æ˜¯â€œstepâ€ã€‚åŸºæœ¬ä¸Šï¼Œstepå‘Šè¯‰Jenkins è¦åšä»€ä¹ˆï¼Œå¹¶ä¸”ä½œä¸ºDeclarative Pipelineå’ŒScripted Pipelineè¯­æ³•çš„åŸºæœ¬æ„å»ºå—ã€‚<br>
Pipelineæ”¯æŒä¸¤ç§è¯­æ³•ï¼šDeclarative Pipelineï¼ˆåœ¨Pipeline 2.5ä¸­å¼•å…¥ï¼Œç»“æ„åŒ–æ–¹å¼ï¼‰å’ŒScripted Pipelineï¼Œä¸¤è€…éƒ½æ”¯æŒå»ºç«‹è¿ç»­è¾“é€çš„Pipelineã€‚<br>
ä¸ºä¸BlueOceanè„šæœ¬ç¼–è¾‘å™¨å…¼å®¹ï¼Œé€šå¸¸å»ºè®®ä½¿ç”¨Declarative Pipelineçš„æ–¹å¼è¿›è¡Œç¼–å†™,ä»jenkinsç¤¾åŒºçš„åŠ¨å‘æ¥çœ‹ï¼Œå¾ˆæ˜æ˜¾è¿™ç§è¯­æ³•ç»“æ„ä¹Ÿä¼šæ˜¯æœªæ¥çš„è¶‹åŠ¿ã€‚</p>
<h2 id="ä¸‰-declarative-pipeline">ä¸‰ã€Declarative Pipeline</h2>
<p>Declarative Pipelineæ˜¯Jenkins Pipeline çš„ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„è¡¥å……ï¼Œ å®ƒåœ¨Pipelineå­ç³»ç»Ÿä¹‹ä¸Šæå‡ºäº†ä¸€ç§æ›´ä¸ºç®€åŒ–å’Œæœ‰æ„ä¹‰çš„è¯­æ³•ã€‚<br>
æ‰€æœ‰æœ‰æ•ˆçš„Declarative Pipelineå¿…é¡»åŒ…å«åœ¨ä¸€ä¸ªpipelineå—å†…ï¼Œä¾‹å¦‚ï¼š<br>
pipeline { /* insert Declarative Pipeline here */ }<br>
Declarative Pipelineä¸­çš„åŸºæœ¬è¯­å¥å’Œè¡¨è¾¾å¼éµå¾ªä¸Groovyè¯­æ³•ç›¸åŒçš„è§„åˆ™ ï¼Œä½†æœ‰ä»¥ä¸‹ä¾‹å¤–ï¼š<br>
a.Pipelineçš„é¡¶å±‚å¿…é¡»æ˜¯å—ï¼Œå…·ä½“æ¥è¯´æ˜¯ï¼špipeline { }<br>
b.æ²¡æœ‰åˆ†å·ä½œä¸ºè¯­å¥åˆ†éš”ç¬¦ã€‚æ¯ä¸ªå£°æ˜å¿…é¡»åœ¨è‡ªå·±çš„ä¸€è¡Œ<br>
c.å—åªèƒ½åŒ…å«Sections, Directives, Stepsæˆ–èµ‹å€¼è¯­å¥ã€‚<br>
d.å±æ€§å¼•ç”¨è¯­å¥è¢«è§†ä¸ºæ— å‚æ–¹æ³•è°ƒç”¨ã€‚æ‰€ä»¥ä¾‹å¦‚ï¼Œè¾“å…¥è¢«è§†ä¸ºinputï¼ˆï¼‰</p>
<h3 id="1sectionsç« èŠ‚">1.Sectionsï¼ˆç« èŠ‚ï¼‰</h3>
<p>Declarative Pipelineé‡Œçš„Sectionsé€šå¸¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªDirectivesæˆ– Steps</p>
<h4 id="agent">agent</h4>
<p>è¯¥agentéƒ¨åˆ†æŒ‡å®šæ•´ä¸ªPipelineæˆ–ç‰¹å®šé˜¶æ®µå°†åœ¨Jenkinsç¯å¢ƒä¸­æ‰§è¡Œçš„ä½ç½®ï¼Œå…·ä½“å–å†³äºè¯¥agent éƒ¨åˆ†çš„æ”¾ç½®ä½ç½®ã€‚è¯¥éƒ¨åˆ†å¿…é¡»åœ¨pipelineå—å†…çš„é¡¶å±‚å®šä¹‰ ï¼Œä½†stageçº§ä½¿ç”¨æ˜¯å¯é€‰çš„ã€‚</p>
<figure data-type="image" tabindex="1"><a href="https://testerhome.com/uploads/photo/2017/b4ca18e6-8aa8-44a1-a420-cd055dbc5be6.png!large"><img src="https://testerhome.com/uploads/photo/2017/b4ca18e6-8aa8-44a1-a420-cd055dbc5be6.png!large" alt="img"></a></figure>
<p>å‚æ•°</p>
<pre><code>docker
agent {
    docker {
        image 'maven:3-alpine'
        label 'my-defined-label'
        args  '-v /tmp:/tmp'
    }
}
</code></pre>
<p>dockerfile<br>
ä½¿ç”¨ä»Dockerfileæºå­˜å‚¨åº“ä¸­åŒ…å«çš„å®¹å™¨æ¥æ„å»ºæ‰§è¡ŒPipelineæˆ–stage ã€‚ä¸ºäº†ä½¿ç”¨æ­¤é€‰é¡¹ï¼ŒJenkinsfileå¿…é¡»ä»Multibranch Pipelineæˆ–â€œPipeline from SCM&quot;åŠ è½½ã€‚<br>
é»˜è®¤æ˜¯åœ¨Dockerfileæºåº“çš„æ ¹ç›®å½•ï¼šagent { dockerfile true }ã€‚å¦‚æœDockerfileéœ€åœ¨å¦ä¸€ä¸ªç›®å½•ä¸­å»ºç«‹ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹diré€‰é¡¹ï¼šagent { dockerfile { dir 'someSubDir' } }ã€‚æ‚¨å¯ä»¥é€šè¿‡docker build ...ä½¿ç”¨additionalBuildArgsé€‰é¡¹ï¼Œå¦‚agent { dockerfile { additionalBuildArgs '--build-arg foo=bar' } }ã€‚<br>
<strong>å¸¸ç”¨é€‰é¡¹</strong><br>
è¿™äº›æ˜¯å¯ä»¥åº”ç”¨äºä¸¤ä¸ªæˆ–å¤šä¸ªagentçš„é€‰é¡¹ã€‚é™¤éæ˜ç¡®å®šä¹‰ï¼Œå¦åˆ™ä¸éœ€è¦ã€‚<br>
label<br>
ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚æ ‡è®°åœ¨å“ªé‡Œè¿è¡Œpipelineæˆ–stage<br>
æ­¤é€‰é¡¹é€‚ç”¨äºnodeï¼Œdockerå’Œdockerfileï¼Œå¹¶ä¸” nodeæ˜¯å¿…éœ€çš„ã€‚<br>
customWorkspace<br>
ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚è‡ªå®šä¹‰è¿è¡Œçš„å·¥ä½œç©ºé—´å†…ã€‚å®ƒå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰å·¥ä½œåŒºå°†ä½äºèŠ‚ç‚¹ä¸Šçš„å·¥ä½œç©ºé—´æ ¹ç›®å½•ä¸‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code>customWorkspace
agent {
    node {
        label 'my-defined-label'
        customWorkspace '/some/other/path'
    }
}
</code></pre>
<p>reuseNode<br>
ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸ºfalseã€‚å¦‚æœä¸ºtrueï¼Œåˆ™åœ¨åŒä¸€å·¥ä½œç©ºé—´ä¸­ã€‚<br>
æ­¤é€‰é¡¹é€‚ç”¨äºdockerå’Œdockerfileï¼Œå¹¶ä¸”ä»…åœ¨ individual stageä¸­ä½¿ç”¨agentæ‰æœ‰æ•ˆã€‚<br>
<strong>Example</strong></p>
<pre><code>Jenkinsfile (Declarative Pipeline)
pipeline {
    //Execute all the steps defined in this Pipeline within a newly created container of the given name and tag (maven:3-alpine).
    agent { docker 'maven:3-alpine' } 
    stages {
        stage('Example Build') {
            steps {
                sh 'mvn -B clean verify'
            }
        }
    }
}
</code></pre>
<pre><code>Stage-level agent section
pipeline {
    agent none 
    stages {
        stage('Example Build') {
            agent { docker 'maven:3-alpine' } 
            steps {
                echo 'Hello, Maven'
                sh 'mvn --version'
            }
        }
        stage('Example Test') {
            agent { docker 'openjdk:8-jre' } 
            steps {
                echo 'Hello, JDK'
                sh 'java -version'
            }
        }
    }
}
</code></pre>
<h4 id="post">post</h4>
<p>å®šä¹‰Pipelineæˆ–stageè¿è¡Œç»“æŸæ—¶çš„æ“ä½œã€‚post-conditionå—æ”¯æŒpostéƒ¨ä»¶ï¼šalwaysï¼Œchangedï¼Œfailureï¼Œsuccessï¼Œunstableï¼Œå’Œabortedã€‚è¿™äº›å—å…è®¸åœ¨Pipelineæˆ–stageè¿è¡Œç»“æŸæ—¶æ‰§è¡Œæ­¥éª¤ï¼Œå…·ä½“å–å†³äºPipelineçš„çŠ¶æ€ã€‚</p>
<figure data-type="image" tabindex="2"><a href="https://testerhome.com/uploads/photo/2017/d0548c42-0ee4-435c-844d-fc9969735cc8.png!large"><img src="https://testerhome.com/uploads/photo/2017/d0548c42-0ee4-435c-844d-fc9969735cc8.png!large" alt="img"></a></figure>
<p>conditionsé¡¹ï¼š</p>
<p><strong>Example</strong></p>
<pre><code>post
pipeline {
    agent any
    stages {
        stage('Example') {
            steps {
                echo 'Hello World'
            }
        }
    }
    post { 
        always { 
            echo 'I will always say Hello again!'
        }
    }
}
</code></pre>
<h4 id="stages">stages</h4>
<p>åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªstageçš„åºåˆ—ï¼ŒPipelineçš„å¤§éƒ¨åˆ†å·¥ä½œåœ¨æ­¤æ‰§è¡Œã€‚å»ºè®®stagesè‡³å°‘åŒ…å«è‡³å°‘ä¸€ä¸ªstageæŒ‡ä»¤ï¼Œç”¨äºè¿æ¥å„ä¸ªäº¤ä»˜è¿‡ç¨‹ï¼Œå¦‚æ„å»ºï¼Œæµ‹è¯•å’Œéƒ¨ç½²ç­‰ã€‚</p>
<figure data-type="image" tabindex="3"><a href="https://testerhome.com/uploads/photo/2017/be8f539b-1b8e-41c4-9ea9-a909041385a3.png!large"><img src="https://testerhome.com/uploads/photo/2017/be8f539b-1b8e-41c4-9ea9-a909041385a3.png!large" alt="img"></a></figure>
<h4 id="steps">steps</h4>
<p>stepsåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåœ¨stageå—ä¸­æ‰§è¡Œçš„stepåºåˆ—ã€‚</p>
<figure data-type="image" tabindex="4"><a href="https://testerhome.com/uploads/photo/2017/19f88fdb-c8fa-448b-8a2f-0f8c2e73c746.png!large"><img src="https://testerhome.com/uploads/photo/2017/19f88fdb-c8fa-448b-8a2f-0f8c2e73c746.png!large" alt="img"></a></figure>
<p><strong>Example</strong></p>
<pre><code>stages
pipeline {
    agent any
    stages { 
        stage('Example') {
            steps {
                echo 'Hello World'
            }
        }
    }
}
</code></pre>
<h3 id="2directives-æŒ‡ä»¤">2.Directives ï¼ˆæŒ‡ä»¤ï¼‰</h3>
<h4 id="environment">environment</h4>
<p>environmentæŒ‡ä»¤æŒ‡å®šä¸€ç³»åˆ—é”®å€¼å¯¹ï¼Œè¿™äº›é”®å€¼å¯¹å°†è¢«å®šä¹‰ä¸ºæ‰€æœ‰stepæˆ–stage-specific stepçš„ç¯å¢ƒå˜é‡ï¼Œå…·ä½“å–å†³äºenvironmentæŒ‡ä»¤åœ¨Pipelineä¸­çš„ä½ç½®ã€‚<br>
è¯¥æŒ‡ä»¤æ”¯æŒä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•credentials()ï¼Œå¯ä»¥é€šè¿‡å…¶åœ¨Jenkinsç¯å¢ƒä¸­çš„æ ‡è¯†ç¬¦æ¥è®¿é—®é¢„å®šä¹‰çš„å‡­æ®ã€‚<br>
å¯¹äºç±»å‹ä¸ºâ€œSecret Textâ€çš„å‡­æ®ï¼Œè¯¥ credentials()æ–¹æ³•å°†ç¡®ä¿æŒ‡å®šçš„ç¯å¢ƒå˜é‡åŒ…å«Secret Textå†…å®¹ï¼›å¯¹äºâ€œæ ‡å‡†ç”¨æˆ·åå’Œå¯†ç â€ç±»å‹çš„å‡­è¯ï¼ŒæŒ‡å®šçš„ç¯å¢ƒå˜é‡å°†è¢«è®¾ç½®ä¸ºusername:passwordã€‚</p>
<figure data-type="image" tabindex="5"><a href="https://testerhome.com/uploads/photo/2017/61e1a1c8-ccaf-4e17-95a2-cf0fc874befb.png!large"><img src="https://testerhome.com/uploads/photo/2017/61e1a1c8-ccaf-4e17-95a2-cf0fc874befb.png!large" alt="img"></a></figure>
<p><strong>Example</strong></p>
<pre><code>environment
pipeline {
    agent any
    environment { 
        CC = 'clang'
    }
    stages {
        stage('Example') {
            environment { 
                AN_ACCESS_KEY = credentials('my-prefined-secret-text') 
            }
            steps {
                sh 'printenv'
            }
        }
    }
}
</code></pre>
<h4 id="options">options</h4>
<p>optionsæŒ‡ä»¤å…è®¸åœ¨Pipelineæœ¬èº«å†…é…ç½®Pipelineä¸“ç”¨é€‰é¡¹ã€‚Pipelineæœ¬èº«æä¾›äº†è®¸å¤šé€‰é¡¹ï¼Œä¾‹å¦‚buildDiscarderï¼Œä½†å®ƒä»¬ä¹Ÿå¯èƒ½ç”±æ’ä»¶æä¾›ï¼Œä¾‹å¦‚ timestampsã€‚</p>
<figure data-type="image" tabindex="6"><a href="https://testerhome.com/uploads/photo/2017/62df009a-9155-4db0-b164-2cda48a08b81.png!large"><img src="https://testerhome.com/uploads/photo/2017/62df009a-9155-4db0-b164-2cda48a08b81.png!large" alt="img"></a></figure>
<p><strong>å¯ç”¨é€‰é¡¹</strong><br>
buildDiscarder<br>
pipelineä¿æŒæ„å»ºçš„æœ€å¤§ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼šoptions { buildDiscarder(logRotator(numToKeepStr: '1')) }<br>
disableConcurrentBuilds<br>
ä¸å…è®¸å¹¶è¡Œæ‰§è¡ŒPipeline,å¯ç”¨äºé˜²æ­¢åŒæ—¶è®¿é—®å…±äº«èµ„æºç­‰ã€‚ä¾‹å¦‚ï¼šoptions { disableConcurrentBuilds() }<br>
skipDefaultCheckout<br>
é»˜è®¤è·³è¿‡æ¥è‡ªæºä»£ç æ§åˆ¶çš„ä»£ç ã€‚ä¾‹å¦‚ï¼šoptions { skipDefaultCheckout() }<br>
skipStagesAfterUnstable<br>
ä¸€æ—¦æ„å»ºçŠ¶æ€è¿›å…¥äº†â€œUnstableâ€çŠ¶æ€ï¼Œå°±è·³è¿‡æ­¤stageã€‚ä¾‹å¦‚ï¼šoptions { skipStagesAfterUnstable() }<br>
timeout<br>
è®¾ç½®Pipelineè¿è¡Œçš„è¶…æ—¶æ—¶é—´ã€‚ä¾‹å¦‚ï¼šoptions { timeout(time: 1, unit: 'HOURS') }<br>
retry<br>
å¤±è´¥åï¼Œé‡è¯•æ•´ä¸ªPipelineçš„æ¬¡æ•°ã€‚ä¾‹å¦‚ï¼šoptions { retry(3) }<br>
timestamps<br>
é¢„å®šä¹‰ç”±Pipelineç”Ÿæˆçš„æ‰€æœ‰æ§åˆ¶å°è¾“å‡ºæ—¶é—´ã€‚ä¾‹å¦‚ï¼šoptions { timestamps() }</p>
<p><strong>Example</strong></p>
<pre><code>options
pipeline {
    agent any
    options {
        timeout(time: 1, unit: 'HOURS') 
    }
    stages {
        stage('Example') {
            steps {
                echo 'Hello World'
            }
        }
    }
}
</code></pre>
<h4 id="parameters">parameters</h4>
<p>parametersæŒ‡ä»¤æä¾›ç”¨æˆ·åœ¨è§¦å‘Pipelineæ—¶çš„å‚æ•°åˆ—è¡¨ã€‚è¿™äº›å‚æ•°å€¼é€šè¿‡è¯¥paramså¯¹è±¡å¯ç”¨äºPipelineæ­¥éª¤ï¼Œå…·ä½“ç”¨æ³•å¦‚ä¸‹</p>
<figure data-type="image" tabindex="7"><a href="https://testerhome.com/uploads/photo/2017/a063f9e2-a6c6-41ea-b121-e1fc99acb112.png!large"><img src="https://testerhome.com/uploads/photo/2017/a063f9e2-a6c6-41ea-b121-e1fc99acb112.png!large" alt="img"></a></figure>
<p><strong>å¯ç”¨å‚æ•°</strong><br>
string<br>
A parameter of a string type, for example: parameters { string(name: 'DEPLOY_ENV', defaultValue: 'staging', description: '') }<br>
booleanParam<br>
A boolean parameter, for example: parameters { booleanParam(name: 'DEBUG_BUILD', defaultValue: true, description: '') }<br>
ç›®å‰åªæ”¯æŒ[booleanParam, choice, credentials, file, text, password, run, string]è¿™å‡ ç§å‚æ•°ç±»å‹ï¼Œå…¶ä»–é«˜çº§å‚æ•°åŒ–ç±»å‹è¿˜éœ€ç­‰å¾…ç¤¾åŒºæ”¯æŒã€‚<br>
<strong>Example</strong></p>
<pre><code>params
pipeline {
    agent any
    parameters {
        string(name: 'PERSON', defaultValue: 'Mr Jenkins', description: 'Who should I say hello to?')
    }
    stages {
        stage('Example') {
            steps {
                echo &quot;Hello ${params.PERSON}&quot;
            }
        }
    }
}
</code></pre>
<h4 id="triggers">triggers</h4>
<p>triggersæŒ‡ä»¤å®šä¹‰äº†Pipelineè‡ªåŠ¨åŒ–è§¦å‘çš„æ–¹å¼ã€‚å¯¹äºä¸æºä»£ç é›†æˆçš„Pipelineï¼Œå¦‚GitHubæˆ–BitBucketï¼Œtriggerså¯èƒ½ä¸éœ€è¦åŸºäºwebhookçš„é›†æˆä¹Ÿå·²ç»å­˜åœ¨ã€‚ç›®å‰åªæœ‰ä¸¤ä¸ªå¯ç”¨çš„è§¦å‘å™¨ï¼šcronå’ŒpollSCMã€‚</p>
<figure data-type="image" tabindex="8"><a href="https://testerhome.com/uploads/photo/2017/763dc697-6402-47a2-b90c-77453ad89b88.png!large"><img src="https://testerhome.com/uploads/photo/2017/763dc697-6402-47a2-b90c-77453ad89b88.png!large" alt="img"></a></figure>
<p><strong>Example</strong></p>
<pre><code>triggers
pipeline {
    agent any
    triggers {
        cron('H 4/* 0 0 1-5')
    }
    stages {
        stage('Example') {
            steps {
                echo 'Hello World'
            }
        }
    }
}
</code></pre>
<h4 id="stage">stage</h4>
<p>stageæŒ‡ä»¤åœ¨stageséƒ¨åˆ†ä¸­ï¼Œåº”åŒ…å«stopéƒ¨åˆ†ï¼Œå¯é€‰agentéƒ¨åˆ†æˆ–å…¶ä»–ç‰¹å®šäºstageçš„æŒ‡ä»¤ã€‚å®é™…ä¸Šï¼ŒPipelineå®Œæˆçš„æ‰€æœ‰å®é™…å·¥ä½œéƒ½å°†åŒ…å«åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªstageæŒ‡ä»¤ä¸­ã€‚</p>
<figure data-type="image" tabindex="9"><a href="https://testerhome.com/uploads/photo/2017/3bdce47e-87af-4264-8c9d-68f27cdf816c.png!large"><img src="https://testerhome.com/uploads/photo/2017/3bdce47e-87af-4264-8c9d-68f27cdf816c.png!large" alt="img"></a></figure>
<p><strong>Example</strong></p>
<pre><code>stage
pipeline {
    agent any
    stages {
        stage('Example') {
            steps {
                echo 'Hello World'
            }
        }
    }
}
</code></pre>
<h4 id="tools">tools</h4>
<p>é€šè¿‡toolså¯è‡ªåŠ¨å®‰è£…å·¥å…·ï¼Œå¹¶æ”¾ç½®ç¯å¢ƒå˜é‡åˆ°PATHã€‚å¦‚æœagent noneï¼Œè¿™å°†è¢«å¿½ç•¥ã€‚</p>
<figure data-type="image" tabindex="10"><a href="https://testerhome.com/uploads/photo/2017/027fa60d-c999-477c-a333-172f92ec5f91.png!large"><img src="https://testerhome.com/uploads/photo/2017/027fa60d-c999-477c-a333-172f92ec5f91.png!large" alt="img"></a></figure>
<p><strong>Supported Tools</strong><br>
maven<br>
jdk<br>
gradle</p>
<p><strong>Example</strong></p>
<pre><code>tools
pipeline {
    agent any
    tools {
        //å·¥å…·åç§°å¿…é¡»åœ¨Jenkins ç®¡ç†Jenkins â†’ å…¨å±€å·¥å…·é…ç½®ä¸­é¢„é…ç½®ã€‚
        maven 'apache-maven-3.0.1'
    }
    stages {
        stage('Example') {
            steps {
                sh 'mvn --version'
            }
        }
    }
}
</code></pre>
<h4 id="when">when</h4>
<p>whenæŒ‡ä»¤å…è®¸Pipelineæ ¹æ®ç»™å®šçš„æ¡ä»¶ç¡®å®šæ˜¯å¦æ‰§è¡Œè¯¥é˜¶æ®µã€‚è¯¥whenæŒ‡ä»¤å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªæ¡ä»¶ã€‚å¦‚æœwhenæŒ‡ä»¤åŒ…å«å¤šä¸ªæ¡ä»¶ï¼Œåˆ™æ‰€æœ‰å­æ¡ä»¶å¿…é¡»ä¸ºstageæ‰§è¡Œè¿”å›trueã€‚è¿™ä¸å­æ¡ä»¶åµŒå¥—åœ¨ä¸€ä¸ªallOfæ¡ä»¶ä¸­ç›¸åŒï¼ˆè§ä¸‹é¢çš„ä¾‹å­ï¼‰ã€‚<br>
æ›´å¤æ‚çš„æ¡ä»¶ç»“æ„å¯ä½¿ç”¨åµŒå¥—æ¡ä»¶å»ºï¼šnotï¼ŒallOfæˆ–anyOfã€‚åµŒå¥—æ¡ä»¶å¯ä»¥åµŒå¥—åˆ°ä»»æ„æ·±åº¦ã€‚</p>
<figure data-type="image" tabindex="11"><a href="https://testerhome.com/uploads/photo/2017/e9d5d0eb-9855-4a72-a4a6-56c1fde975de.png!large"><img src="https://testerhome.com/uploads/photo/2017/e9d5d0eb-9855-4a72-a4a6-56c1fde975de.png!large" alt="img"></a></figure>
<p><strong>å†…ç½®æ¡ä»¶</strong><br>
branch<br>
å½“æ­£åœ¨æ„å»ºçš„åˆ†æ”¯ä¸ç»™å‡ºçš„åˆ†æ”¯æ¨¡å¼åŒ¹é…æ—¶æ‰§è¡Œï¼Œä¾‹å¦‚ï¼šwhen { branch 'master' }ã€‚è¯·æ³¨æ„ï¼Œè¿™ä»…é€‚ç”¨äºå¤šåˆ†æ”¯Pipelineã€‚<br>
environment<br>
å½“æŒ‡å®šçš„ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºç»™å®šå€¼æ—¶æ‰§è¡Œï¼Œä¾‹å¦‚ï¼š when { environment name: 'DEPLOY_TO', value: 'production' }<br>
expression<br>
å½“æŒ‡å®šçš„Groovyè¡¨è¾¾å¼æ±‚å€¼ä¸ºtrueæ—¶æ‰§è¡Œï¼Œä¾‹å¦‚ï¼š when { expression { return params.DEBUG_BUILD } }<br>
not<br>
å½“åµŒå¥—æ¡ä»¶ä¸ºfalseæ—¶æ‰§è¡Œã€‚å¿…é¡»åŒ…å«ä¸€ä¸ªæ¡ä»¶ã€‚ä¾‹å¦‚ï¼šwhen { not { branch 'master' } }<br>
allOf<br>
å½“æ‰€æœ‰åµŒå¥—æ¡ä»¶éƒ½ä¸ºçœŸæ—¶æ‰§è¡Œã€‚å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªæ¡ä»¶ã€‚ä¾‹å¦‚ï¼šwhen { allOf { branch 'master'; environment name: 'DEPLOY_TO', value: 'production' } }<br>
anyOf<br>
å½“è‡³å°‘ä¸€ä¸ªåµŒå¥—æ¡ä»¶ä¸ºçœŸæ—¶æ‰§è¡Œã€‚å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªæ¡ä»¶ã€‚ä¾‹å¦‚ï¼šwhen { anyOf { branch 'master'; branch 'staging' } }</p>
<p><strong>Example</strong></p>
<pre><code>when
pipeline {
    agent any
    stages {
        stage('Example Build') {
            steps {
                echo 'Hello World'
            }
        }
        stage('Example Deploy') {
            when {
                allOf {
                    branch 'production'
                    environment name: 'DEPLOY_TO', value: 'production'
                }
            }
            steps {
                echo 'Deploying'
            }
        }
    }
}
</code></pre>
<h3 id="3parallelå¹¶è¡Œ">3.Parallel(å¹¶è¡Œ)</h3>
<p>2017.9.25æ–°å¢parallel stageæ”¯æŒã€‚<br>
Declarative Pipelineè¿‘æœŸæ–°å¢äº†å¯¹å¹¶è¡ŒåµŒå¥—stageçš„æ”¯æŒï¼Œå¯¹è€—æ—¶é•¿ï¼Œç›¸äº’ä¸å­˜åœ¨ä¾èµ–çš„stageå¯ä»¥ä½¿ç”¨æ­¤æ–¹å¼æå‡è¿è¡Œæ•ˆç‡ã€‚é™¤äº†parallel stageï¼Œå•ä¸ªparallelé‡Œçš„å¤šä¸ªstepä¹Ÿå¯ä»¥ä½¿ç”¨å¹¶è¡Œçš„æ–¹å¼è¿è¡Œã€‚</p>
<p><strong>Example</strong></p>
<pre><code>Jenkinsfile (Declarative Pipeline)
pipeline {
    agent any
    stages {
        stage('Non-Parallel Stage') {
            steps {
                echo 'This stage will be executed first.'
            }
        }
        stage('Parallel Stage') {
            when {
                branch 'master'
            }
            parallel {
                stage('Branch A') {
                    agent {
                        label &quot;for-branch-a&quot;
                    }
                    steps {
                        echo &quot;On Branch A&quot;
                    }
                }
                stage('Branch B') {
                    agent {
                        label &quot;for-branch-b&quot;
                    }
                    steps {
                        echo &quot;On Branch B&quot;
                    }
                }
            }
        }
    }
}
</code></pre>
<h3 id="4stepsæ­¥éª¤">4.Stepsï¼ˆæ­¥éª¤ï¼‰</h3>
<p>Declarative Pipelineå¯ä»¥ä½¿ç”¨ Pipeline Steps referenceä¸­çš„æ‰€æœ‰å¯ç”¨æ­¥éª¤ ï¼Œå¹¶é™„åŠ ä»¥ä¸‹ä»…åœ¨Declarative Pipelineä¸­æ”¯æŒçš„æ­¥éª¤ã€‚</p>
<h4 id="script">script</h4>
<p>scriptæ­¥éª¤éœ€è¦ä¸€ä¸ªscript Pipelineï¼Œå¹¶åœ¨Declarative Pipelineä¸­æ‰§è¡Œã€‚å¯¹äºå¤§å¤šæ•°ç”¨ä¾‹ï¼Œscriptåœ¨Declarative Pipelineä¸­çš„æ­¥éª¤ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†å®ƒå¯ä»¥æä¾›ä¸€ä¸ªæœ‰ç”¨çš„åŠ å¼ºã€‚</p>
<p><strong>Example</strong></p>
<pre><code>script
pipeline {
    agent any
    stages {
        stage('Example') {
            steps {
                echo 'Hello World'

                script {
                    def browsers = ['chrome', 'firefox']
                    for (int i = 0; i &lt; browsers.size(); ++i) {
                        echo &quot;Testing the ${browsers[i]} browser&quot;
                    }
                }
            }
        }
    }
}
</code></pre>
<h2 id="å››-scripted-pipeline">å››ã€Scripted Pipeline</h2>
<p>Groovyè„šæœ¬ä¸ä¸€å®šé€‚åˆæ‰€æœ‰ä½¿ç”¨è€…ï¼Œå› æ­¤jenkinsåˆ›å»ºäº†Declarative pipelineï¼Œä¸ºç¼–å†™Jenkinsç®¡é“æä¾›äº†ä¸€ç§æ›´ç®€å•ã€æ›´æœ‰ä¸»è§çš„è¯­æ³•ã€‚ä½†æ˜¯ä¸å¯å¦è®¤ï¼Œç”±äºè„šæœ¬åŒ–çš„pipelineæ˜¯åŸºäºgroovyçš„ä¸€ç§DSLè¯­è¨€ï¼Œæ‰€ä»¥ä¸Declarative pipelineç›¸æ¯”ä¸ºjenkinsç”¨æˆ·æä¾›äº†æ›´å·¨å¤§çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<h3 id="1æµç¨‹æ§åˆ¶">1.æµç¨‹æ§åˆ¶</h3>
<p>pipelineè„šæœ¬åŒå…¶å®ƒè„šæœ¬è¯­è¨€ä¸€æ ·ï¼Œä»ä¸Šè‡³ä¸‹é¡ºåºæ‰§è¡Œï¼Œå®ƒçš„æµç¨‹æ§åˆ¶å–å†³äºGroovyè¡¨è¾¾å¼ï¼Œå¦‚if/elseæ¡ä»¶è¯­å¥ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code>Jenkinsfile (Scripted Pipeline)
node {
    stage('Example') {
        if (env.BRANCH_NAME == 'master') {
            echo 'I only execute on the master branch'
        } else {
            echo 'I execute elsewhere'
        }
    }
}
</code></pre>
<p>pipelineè„šæœ¬æµç¨‹æ§åˆ¶çš„å¦ä¸€ç§æ–¹å¼æ˜¯Groovyçš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚å½“ä»»ä½•ä¸€ä¸ªæ­¥éª¤å› å„ç§åŸå› è€Œå‡ºç°å¼‚å¸¸æ—¶ï¼Œéƒ½å¿…é¡»åœ¨Groovyä¸­ä½¿ç”¨try/catch/finallyè¯­å¥å—è¿›è¡Œå¤„ç†ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code>Jenkinsfile (Scripted Pipeline)
node {
    stage('Example') {
        try {
            sh 'exit 1'
        }
        catch (exc) {
            echo 'Something failed, I should sound the klaxons!'
            throw
        }
    }
}
</code></pre>
<h3 id="2steps">2.Steps</h3>
<p>æ­£å¦‚æ–‡æ¡£å¼€å§‹æ‰€è¨€ï¼Œpipelineæœ€æ ¸å¿ƒå’ŒåŸºæœ¬çš„éƒ¨åˆ†å°±æ˜¯â€œstepâ€ï¼Œä»æ ¹æœ¬ä¸Šæ¥è¯´ï¼Œstepsä½œä¸ºDeclarative pipelineå’ŒScripted pipelineè¯­æ³•çš„æœ€åŸºæœ¬çš„è¯­å¥æ„å»ºå—æ¥å‘Šè¯‰jenkinsåº”è¯¥æ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚<br>
Scripted pipelineæ²¡æœ‰ä¸“é—¨å°†stepsä½œä¸ºå®ƒçš„è¯­æ³•çš„ä¸€éƒ¨åˆ†æ¥ä»‹ç»ï¼Œä½†æ˜¯åœ¨Pipeline Steps referenceè¿™ç¯‡æ–‡æ¡£ä¸­å¯¹pipelineåŠå…¶æ’ä»¶æ¶‰åŠçš„stepsåšäº†å¾ˆè¯¦ç»†çš„ä»‹ç»ã€‚å¦‚æœ‰éœ€è¦å¯å‚è€ƒjenkinså®˜ç½‘å¯¹è¯¥éƒ¨åˆ†çš„ä»‹ç»Pipeline Steps reference</p>
<h3 id="3differences-from-plain-groovy">3.Differences from plain Groovy</h3>
<p>ç”±äºpipelineçš„ä¸€äº›ä¸ªæ€§åŒ–éœ€æ±‚ï¼Œæ¯”å¦‚åœ¨é‡æ–°å¯åŠ¨jenkinsåè¦æ±‚pipelineè„šæœ¬ä»ç„¶å¯ä»¥è¿è¡Œï¼Œé‚£ä¹ˆpipelineè„šæœ¬å¿…é¡»å°†ç›¸å…³æ•°æ®åšåºåˆ—åŒ–ï¼Œç„¶è€Œè¿™ä¸€ç‚¹ Groovyå¹¶ä¸èƒ½å®Œç¾çš„æ”¯æŒï¼Œä¾‹å¦‚collection.each { item -&gt; /* perform operation */ }</p>
<h3 id="4declarative-pipelineå’Œscripted-pipelineçš„æ¯”è¾ƒ">4.Declarative pipelineå’ŒScripted pipelineçš„æ¯”è¾ƒ</h3>
<p>å…±åŒç‚¹ï¼š<br>
ä¸¤è€…éƒ½æ˜¯pipelineä»£ç çš„æŒä¹…å®ç°ï¼Œéƒ½èƒ½å¤Ÿä½¿ç”¨pipelineå†…ç½®çš„æ’ä»¶æˆ–è€…æ’ä»¶æä¾›çš„stepsï¼Œä¸¤è€…éƒ½å¯ä»¥åˆ©ç”¨å…±äº«åº“æ‰©å±•ã€‚<br>
åŒºåˆ«ï¼š<br>
ä¸¤è€…ä¸åŒä¹‹å¤„åœ¨äºè¯­æ³•å’Œçµæ´»æ€§ã€‚Declarative pipelineå¯¹ç”¨æˆ·æ¥è¯´ï¼Œè¯­æ³•æ›´ä¸¥æ ¼ï¼Œæœ‰å›ºå®šçš„ç»„ç»‡ç»“æ„ï¼Œæ›´å®¹æ˜“ç”Ÿæˆä»£ç æ®µï¼Œä½¿å…¶æˆä¸ºç”¨æˆ·æ›´ç†æƒ³çš„é€‰æ‹©ã€‚ä½†æ˜¯Scripted pipelineæ›´åŠ çµæ´»ï¼Œå› ä¸ºGroovyæœ¬èº«åªèƒ½å¯¹ç»“æ„å’Œè¯­æ³•è¿›è¡Œé™åˆ¶ï¼Œå¯¹äºæ›´å¤æ‚çš„pipelineæ¥è¯´ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡è¿›è¡Œçµæ´»çš„å®ç°å’Œæ‰©å±•ã€‚</p>
<p><a href="https://testerhome.com/cay">åŸæ–‡é“¾æ¥:TesterHome@cay</a></p>

                                </div>
                    </article>
                    <!--  -->
                    
                        <div class="next-post">
                            <div class="next">ä¸‹ä¸€ç¯‡</div>
                            <a href="http://wangqunsong.github.io/post/zai-ming-ling-xing-xia-chu-li-yaml">
                                <h3 class="post-title">
                                    åœ¨å‘½ä»¤è¡Œä¸‹å¤„ç† YAML
                                </h3>
                            </a>
                        </div>
                        
                            <div id="disqus_thread"></div>
                            <div id="gitalk-container"></div>
                </div>
                <!-- middle -->
                <div class="main-container-middle"></div>
                <!-- right -->
                <div id="sidebar" class="main-container-right">
                    
                        <!-- toc -->
                        
    <div class="toc-card i-card ">
        <div class="toc-title i-card-title">ç›®å½•</div>
        <div class="toc-content">
            <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">ä¸€ã€å†™åœ¨å‰é¢</a></li>
<li><a href="#%E4%BA%8C-%E8%AF%AD%E6%B3%95%E7%AE%80%E4%BB%8B">äºŒã€è¯­æ³•ç®€ä»‹</a></li>
<li><a href="#%E4%B8%89-declarative-pipeline">ä¸‰ã€Declarative Pipeline</a>
<ul>
<li><a href="#1sections%E7%AB%A0%E8%8A%82">1.Sectionsï¼ˆç« èŠ‚ï¼‰</a>
<ul>
<li><a href="#agent">agent</a></li>
<li><a href="#post">post</a></li>
<li><a href="#stages">stages</a></li>
<li><a href="#steps">steps</a></li>
</ul>
</li>
<li><a href="#2directives-%E6%8C%87%E4%BB%A4">2.Directives ï¼ˆæŒ‡ä»¤ï¼‰</a>
<ul>
<li><a href="#environment">environment</a></li>
<li><a href="#options">options</a></li>
<li><a href="#parameters">parameters</a></li>
<li><a href="#triggers">triggers</a></li>
<li><a href="#stage">stage</a></li>
<li><a href="#tools">tools</a></li>
<li><a href="#when">when</a></li>
</ul>
</li>
<li><a href="#3parallel%E5%B9%B6%E8%A1%8C">3.Parallel(å¹¶è¡Œ)</a></li>
<li><a href="#4steps%E6%AD%A5%E9%AA%A4">4.Stepsï¼ˆæ­¥éª¤ï¼‰</a>
<ul>
<li><a href="#script">script</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%9B%9B-scripted-pipeline">å››ã€Scripted Pipeline</a>
<ul>
<li><a href="#1%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6">1.æµç¨‹æ§åˆ¶</a></li>
<li><a href="#2steps">2.Steps</a></li>
<li><a href="#3differences-from-plain-groovy">3.Differences from plain Groovy</a></li>
<li><a href="#4declarative-pipeline%E5%92%8Cscripted-pipeline%E7%9A%84%E6%AF%94%E8%BE%83">4.Declarative pipelineå’ŒScripted pipelineçš„æ¯”è¾ƒ</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
        <script>
            function locateCatelogList() {
                /*è·å–æ–‡ç« ç›®å½•é›†åˆ,å¯é€šè¿‡:headerè¿‡æ»¤å™¨*/
                var alis = $('.post-content :header');
                /*è·å–ä¾§è¾¹æ ç›®å½•åˆ—è¡¨é›†åˆ**/
                var sidebar_alis = $('.markdownIt-TOC a');
                /*è·å–æ»šåŠ¨æ¡åˆ°é¡¶éƒ¨çš„è·ç¦»*/
                var scroll_height = $(window).scrollTop();
                for (var i = 0; i < alis.length; i++) {
                    /*è·å–é”šç‚¹é›†åˆä¸­çš„å…ƒç´ åˆ†åˆ«åˆ°é¡¶ç‚¹çš„è·ç¦»*/
                    var a_height = $(alis[i]).offset().top;
                    if (a_height < scroll_height) {
                        /*é«˜äº®æ˜¾ç¤º*/
                        sidebar_alis.removeClass('on');
                        $(sidebar_alis[i]).addClass('on');
                    }
                }
            }
            $(function() {
                /*ç»‘å®šæ»šåŠ¨äº‹ä»¶ */
                $(window).bind('scroll', locateCatelogList);
            });
        </script>
    </div>
    
                            

                </div>




            </div>


            <div class="site-footer">
  Powered by <a href="http://www.zootopia.top/" target="_blank">zootopia</a> | 
  <a class="rss" href="http://wangqunsong.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>


    </div>
    <script>
        $('#sidebar').stickySidebar({
            topSpacing: 80,
            // bottomSpacing: 60
        });
    </script>
    
</body>

</html>